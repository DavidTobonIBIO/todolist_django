{% extends "base.html" %}
 {% block content %}

<div class="container">
  <!-- header section -->
  <div class="row mb-4">
    <div class="col-md-8">
      <h2><i class="bi bi-list-task"></i> {{ page_title }}</h2>
    </div>
    {% if page_title == 'My Tasks' %}
    <div class="col-md-4 text-end">
      <a href="{% url 'create-task' %}" class="btn btn-success me-2">
        <i class="bi bi-plus-circle"></i> Add New Task
      </a>
      <a href="{% url 'completed-tasks' %}" class="btn btn-dark">
        <i class="bi bi-check-circle-fill"></i> View Completed Tasks
      </a>
    </div>
    {% else %}
    <div class="col-md-4 text-end">
      <a href="{% url 'task-list' %}" class="btn btn-dark">
        <i class="bi bi-list-task"></i> View Active Tasks
      </a>
    </div>
    {% endif %}
  </div>

  <!-- tasks section -->
  {% if tasks %} 
  {% for task in tasks %}
  <div class="card mb-3 {{ task.priority_color_class }}">
    <!-- card header -->
    <div class="card-header d-flex justify-content-between align-items-center">
      <h5 class="mb-0">{{ task.title }}</h5>
      <span class="badge {{ task.priority_badge_class }}">
        {{ task.get_priority_display }}
      </span>
    </div>

    <!-- card body -->
    <div class="card-body" style="cursor: pointer;" onclick="window.location.href='{% url 'edit-task' task.pk %}'">
      {% if task.description %}
      <p class="card-text">{{ task.description }}</p>
      {% endif %}

      <!-- due date and task list -->
      <div class="row mb-3">
        <div class="col-md-2 mb-2">
      <small class="text-muted">
        <i class="bi bi-calendar-event"></i>
        <strong>Due:</strong> {{ task.due_date|date:"F d, Y" }} 
      </small>
    </div>
    <div class="col-md-2 mb-2">
      <small class="text-muted">
        <i class="bi bi-collection"></i>
        <strong>List:</strong> <span class="badge bg-secondary ms-2">{{ task.task_list.name }}</span>
      </small>
    </div>
      </div>
      
      <!-- completion checkbox and delete button -->
      <div class="row mt-3">
        <div class="col-md-8 text-start">
          <!-- completion checkbox -->
          <div class="form-check" onclick="event.stopPropagation();">
            <input 
              class="form-check-input" 
              type="checkbox" 
              id="complete-{{ task.pk }}"
              {% if task.completed %}checked{% endif %}
              onchange="window.location.href='{% url 'toggle-complete' task.pk %}'"
            >
            <label class="form-check-label" for="complete-{{ task.pk }}">
              {% if task.completed %}
                <span class="text-success">Completed</span>
              {% else %}
                Done
              {% endif %}
            </label>
          </div>
        </div>
        <div class="col-md-4 text-end">
          <!-- Delete button -->
          <div onclick="event.stopPropagation();">
            <a href="{% url 'delete-task' task.pk %}" class="btn btn-outline-danger btn-sm">
              <i class="bi bi-trash"></i>
            </a>
          </div>
        </div>
      </div>
    </div>

    <!-- card footer with created_at info -->
    <div class="card-footer text-muted">
      <small>Created {{ task.created_at|timesince }} ago</small>
    </div>
  </div>
  {% endfor %} 
  {% elif page_title == "My Tasks" %}
  <!-- No tasks state -->
  <div class="text-center py-5">
    <i class="bi bi-inbox display-1 text-muted"></i>
    <h3 class="mt-3 text-muted">No tasks found</h3>
    <a href="{% url 'create-task' %}" class="btn btn-dark btn-lg">
      <i class="bi bi-plus-circle"></i> Create Your First Task
    </a>
  </div>
  {% else %}
    <div class="text-center py-5">
        <i class="bi bi-check-circle display-1 text-muted"></i>
        <h3 class="mt-3 text-muted">No completed tasks</h3>
        <p class="text-muted">Complete some tasks and they'll appear here!</p>
        <a href="{% url 'task-list' %}" class="btn btn-dark">
            <i class="bi bi-list-task"></i> View Active Tasks
        </a>
    </div>
  {% endif %}
</div>

{% endblock content %}